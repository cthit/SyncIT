@using MudBlazor.Extensions
@using SyncIT.Sync.Models
@inject DialogService DialogService
@if (Emails is not null)
{
    <MudChipSet T="EmailAddress" Variant="Variant.Text" OnClose="@Remove">
        @foreach (var email in Emails)
        {
            <MudChip Text="@email.Email"/>
        }
    </MudChipSet>
    <MudChip T="object" Icon="@Icons.Material.Filled._1kPlus" OnClick="@Add"/>
}

<MudMessageBox @ref="_messageBox" Title="Add email" CancelText="Cancel">
    <MessageContent>
        <MudInputString bind-Value="@_emailInput" Validation="@Validate"/>
    </MessageContent>
    <YesButton>
        <MudButton>
            Add
        </MudButton>
    </YesButton>
</MudMessageBox>

@code {
    [Parameter] public ICollection<EmailAddress>? Emails { get; set; } = new HashSet<EmailAddress>();

    private MudMessageBox _messageBox = null!;
    private string _emailInput = string.Empty;

    private Func<string?, string?> Validate => x => x is not null && EmailAddress.IsValid(x) ? null : "Invalid email address";


    private async Task Add()
    {
        var addResponse = await _messageBox.ShowAsync();

        if (Emails is not null && addResponse == true && EmailAddress.IsValid(_emailInput))
        {
            var email = new EmailAddress(_emailInput);
            if (!Emails.Contains(email, EmailAddress.EmailComparer))
            {
                Emails.Add(email);
            }
        }

        _emailInput = string.Empty;
    }

    private void Remove(MudChip<EmailAddress> chip)
    {
        
        if (Emails is null || chip.Value is null)
        {
            return;
        }

        Emails.Remove(chip.Value);
    }

}